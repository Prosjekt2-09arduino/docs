\chapter{Testing}
	This chapter contains a description of the testing performed during the project. Tests were performed in order to ensure product quality and that the product met the requirements. The first sections describe how the tests should be performed, followed by the execution and results of the tests.
	
	\section{Testing strategy}
		The ways in which testing was performed is detailed in this section. Unit testing was performed initially, followed by the integration testing. Following the completion of the Android application, usability testing was executed. User acceptance testing was then performed by the customer after the significant parts were completed~\cite{testing-overview}.

		\subsection{Unit testing}
			For testing of the Android application, Robotium was used. Robotium is a powerful test framework that can be used for function, system and acceptance testing. The tests created in Robotium aims at writing small portions of code and checking the results against expected predefined values. Robotium was used for unit testing on the Android application. During the development of the application, different units were to be tested with Robotium after they were finished. An example of a Robotium test is shown below. In this test it is asserted that the Bluetooth connection with an Arduino device is as expected~\cite{unit-testing1}~\cite{unit-testing2}~\cite{unit-testing3}.\\

			\begin{lstlisting}
solo.clickOnActionBarItem(R.id.settings);

ConnectionState expectedState = BluetoothConnection
	.ConnectionState.STATE_CONNECTED;
	
ConnectionState actualState = BtArduinoService.getBtService()
	.getBluetoothConnection().getConnectionState();

assertEquals(expectedState, actualState);
			\end{lstlisting}

		\subsection{Integration testing}
		Integration testing is based on combining different units and testing the interface and communication between them. This type of testing comes after the unit testing phase and before the validation testing~\cite{validation-testing}. The units that can be used in these tests must therefore have passed the unit tests. This made integration testing focus purely on the integration of units, rather than testing that the units were working correctly as well. Because the system is composed of more than one component (STK500 protocol and the Android application), they were to be tested in pairs and not all at once. Integration testing identifies problems that occur when different units of the product are combined. These test were to be performed when units of the product were put together~\cite{integration-testing2}. Just as in unit testing, Robotium was to be used for integration testing as well.\\

		\subsection{Usability testing}
		As the intent of the product was to ease the use and setup of physical user interfaces, usability tests were crucial in the testing aspects. The decision was made to perform a hallway test, where random test subjects followed the tasks detailed in Section \ref{taskssection}. To ensure that the test subjects had a proper understanding of the product, the think aloud protocol was to be used, meaning the subject was supposed to be talking about their actions during the test.\\
		\newline
		All test subjects filled out a System Usability Scale (SUS) form in order to create a score, 0-100, which gave us a comparable score with other systems. Concerning the amount of subjects tested, five users has been recognized as the proper amount. According to Nielsen, 85\% of the problems with a system will be found by these five users, thus testing more would increase the time spent watching the same problems resurface~\cite{Nielsen}.

		\subsubsection{Tasks}
		\label{taskssection}
			These were the tasks given to each tester. The tasks were created with the use cases mentioned in Chapter \ref{usecases} as a basis. Each task was meant to have a vague description. This way, test subjects would have to think for themselves, instead of simply following detailed steps. \\

			The preface of these tasks was that the test subjects had bought a jacket with an Arduino device fitted in it. This jacket was called an iJacket and they had just downloaded the $\mu$CSS in order for them to check what other applications they could install on the device.

			\vspace{6 mm}
			\begin{enumerate}
			 \item Select your jacket
			 \item Browse applications
			 \item Install the chosen application
			\end{enumerate}
			\vspace{6 mm}

			After the tests, the test subjects were to be asked if at any point during the test they got stuck or confused at any task. The feedback from the test subjects were to be recorded.

		\subsection{User acceptance testing}
		User acceptance testing was to be performed with the customer in order to ensure that requirements were met and to check whether or not the customer was satisfied. This test was to be done in much the same way as the usability. A phone with the application was given to the customer in order for him to get first degree experience with the application. The tester was then asked to perform the same cases as in the usability tests, while a group member recorded his reactions to the application.\\
		\newline

		There were also expert reviews held during a presentation at the offices of SINTEF. The think aloud protocol was also used here. These testers had much experience within development, but not much knowledge about the task. They were therefore given a brief presentation beforehand about the project and given a short presentation of the application itself.\\

	\section{System testing}
	\label{systemtesting}
	In this section the system tests will be presented. Each test was to be written to test a specific part of the product. This applies to both the Android application, STK500 protocol and software installed on the Arduino device. Each test was to be executed separately, and the results will be presented in Section \ref{testresults}.

	\begin{table}[H]
	\caption{Connect with device using device list}
	\begin{tabularx}\linewidth{|m{0.15 \textwidth}|X|}
		\hline
			{Test ID} & {ST01}\\
		\hline
			Test name & Device list connect\\
		\hline
			Test description & Connect with an Arduino device from the Device list screen \\
		\hline
			Precondition & Arduino device is switched on with Bluetooth enabled \\
		\hline
			Test steps & \begin{itemize}
				\item{Start program}
				\item{Press ``Device'' list from Action overflow or from the Welcome screen}
				\item{Press desired Arduino device}
				\end{itemize} \\
		\hline
			Success condition & Android and Arduino device are connected via Bluetooth \\
		\hline
	\end{tabularx}
	\end{table}

	\begin{table}[H]
	\caption{Connect with device using QR Code}
	\begin{tabularx}\linewidth{|m{0.15 \textwidth}|X|}
		\hline
			{Test ID} & {ST02}\\
		\hline
			Test name & QR Code connect\\
		\hline
			Test description & Connect to an Arduino device using QR Code reader \\
		\hline
			Precondition & Arduino device is switched on with Bluetooth enabled \\
		\hline
			Test steps & \begin{itemize}
				\item{Start program}
				\item{Press ``Device'' list from Action overflow}
				\item{Press ``Add'' device}
				\item{Press ``Connect with QR Code''}
				\item{Choose QR Code reader}
				\item{Scan QR Code}
				\end{itemize} \\
		\hline
			Success condition & Android and Arduino device are connected via Bluetooth enabled\\
		\hline
	\end{tabularx}
	\end{table}

	\begin{table}[H]
	\caption{Connect with device using serial}
	\begin{tabularx}\linewidth{|m{0.15 \textwidth}|X|}
		\hline
			{Test ID} & {ST03}\\
		\hline
			Test name & Input serial connect \\
		\hline
			Test description & Connect with an Arduino device using serial \\
		\hline
			Precondition & Arduino device is switched on with Bluetooth enabled\\
		\hline
			Test steps & \begin{itemize}
				\item{Start program}
				\item{Press ``Device'' list from Action overflow}
				\item{Press ``Add'' device}
				\item{Press ``Input serial''}
				\item{Enter MAC address}
				\end{itemize} \\
		\hline
			Success condition & Android and Arduino device are connected via Bluetooth \\
		\hline
	\end{tabularx}
	\end{table}

	\begin{table}[H]
	\caption{Search for desired app}
	\begin{tabularx}\linewidth{|m{0.15 \textwidth}|X|}
		\hline
			{Test ID} & {ST04}\\
		\hline
			Test name & Search \\
		\hline
			Test description & Search for a specific app \\
		\hline
			Precondition & Database is populated \\
		\hline
			Test steps & \begin{itemize}
				\item{Start program}
				\item{Press search icon}
				\item{Type search string}
				\end{itemize} \\
		\hline
			Success condition & Search result is shown with matching apps \\
		\hline
	\end{tabularx}
	\end{table}

	\begin{table}[H]
	\caption{Connect to last connected device on application startup}
	\begin{tabularx}\linewidth{|m{0.15 \textwidth}|X|}
		\hline
			{Test ID} & {ST05}\\
		\hline
			Test name & Last connected\\
		\hline
			Test description & Test that the Android application connects to the last connected Arduino device when the application is started, and gives proper feedback to the user. The application should only reconnect when this option is selected. \\
		\hline
			Precondition & Available Arduino device with Bluetooth \\
		\hline
			Test steps & \begin{itemize}
				\item{Check option ``Automatically try to reconnect to last connected device''}
				\item{Connect with an Arduino}
				\item{Exit Android application completely}
				\item{Start Android application}
					\begin{itemize}
						\item{When the Arduino device is in range}
						\item{When the Arduino device is out of range/off}
					\end{itemize}
				\end{itemize} \\
		\hline
			Success condition & When the last connected Arduino device is on and in range, the Android device should connect to it immediately when the Android application is started and give feedback to the user. If the Arduino device is out of range or off, proper feedback should be given \\
		\hline
	\end{tabularx}
	\end{table}

	\begin{table}[H]
	\caption{Browse apps test}
	\begin{tabularx}\linewidth{|m{0.15 \textwidth}|X|}
		\hline
			Test ID & ST06\\
		\hline
			Test name & Browse apps\\
		\hline
			Test description & Browse apps in the Android application in a random fashion \\
		\hline
			Precondition & Database is populated \\
		\hline
			Test steps & \begin{itemize}
				\item{Start program}
				\item{Choose a category}
				\item{Choose an app}
				\item{Go back and choose different app}
				\item{Swipe left or right to browse different sorting}
				\end{itemize} \\
		\hline
			Success condition & User is able to browse apps \\
		\hline
	\end{tabularx}
	\end{table}

	\begin{table}[H]
	\caption{Install application on Arduino device}
	\begin{tabularx}\linewidth{|m{0.15 \textwidth}|X|}
		\hline
			{Test ID} & {ST07}\\
		\hline
			Test name & Install application on Arduino device\\
		\hline
			Test description & Choose a desired application to install on a connected Arduino device \\
		\hline
			Precondition & Android and Arduino device is connected via Bluetooth \\
		\hline
			Test steps & \begin{itemize}
				\item{Start program}
				\item{Select desired app}
				\item{Press ``Install''}
				\item{Press ``Confirm''}
				\end{itemize} \\
		\hline
			Success condition & Arduino app is installed on the connected Arduino device \\
		\hline
	\end{tabularx}
	\end{table}

	\begin{table}[H]
	\caption{Change connected device}
	\begin{tabularx}\linewidth{|m{0.15 \textwidth}|X|}
		\hline
			{Test ID} & {ST08}\\
		\hline
			Test name & Change connected device\\
		\hline
			Test description & Test that it is possible to first connect to one Arduino, then another, thus changing which device the Android application is connected to \\
		\hline
			Precondition & Two available Arduinos with Bluetooth enabled \\
		\hline
			Test steps & \begin{itemize}
				\item{Start program}
				\item{Connect with Arduino \#1}
				\item{Connect with Arduino \#2}
				\end{itemize} \\
		\hline
			Success condition & Both connections are successful, and the Android device is connected with Arduino \#2 \\
		\hline
	\end{tabularx}
	\end{table}

	\section{Test results}
	\label{testresults}
		In this section the results of all the tests performed will be presented. In each subsection the result of the given type of test will be shown.

		\subsection{Unit testing}
		All written Robotium tests run without encountering errors. This indicates that the units tested work properly and correct values are obtained throughout the testing. A decision was made to not write any more tests, as time was of the essence and resources were needed elsewhere.

		\subsection{Integration testing}
		When different units of the product were ready to be sewn together, integration testing was performed. If bugs and errors were encountered, the person currently responsible for the integration testing would fix it.

		\subsection{System testing}
		The system testing was performed according to the description of the tests in section \ref{systemtesting}. In table~\ref{table:systemtestingtable} the results of each test is shown. These tests were performed when both unit testing and integration testing had been done to ensure that the product met the requirements set by the customer.

	\captionof{table}{System test results}
	\label{table:systemtestingtable}
	\begin{longtable}{|m{0.15 \textwidth}|m{0.15 \textwidth}|m{0.6 \textwidth}|}
\hline
	\rowcolor{Gray}
	\textbf{Test ID} & \textbf{Result} & \textbf{Comment}\\
	\endfirsthead%
	\multicolumn{3}{l}%
	{{\bfseries Continued from previous page}} \\ \hline
	\rowcolor{Gray}
	\textbf{Test ID} & \textbf{Result} & \textbf{Comment}\\
\hline

	\endhead%
	\hline

	\hline \multicolumn{3}{|l|}{{Continued on next page}} \\ \hline
	\endfoot%

	\endlastfoot%
				
				ST01 & Passed & If the Arduino device is on and within range, the Android application successfully connects to it via Bluetooth using the Device List. \\
			\hline
				ST02 & Passed & If the Arduino device is on and within range, and the QR Code is correct, the Android application successfully connects with it via Bluetooth using optional QR reader. \\
			\hline
				ST03 & Passed & If the Arduino device is on and within range, the Android application\newline successfully connects with it via Bluetooth by providing the correct MAC address of the device to the Android application. \\
			\hline
				ST04 & Passed & It is possible to perform searches for apps in the\newline Android application. Apps that fit the search criteria is presented to the user. \\
			\hline
				ST05 & Passed & The application automatically tries to reconnect to the last connected device when this option is selected. It gives proper feedback to the user containing the result of the connection attempt. \\
			\hline
				ST06 & Passed & It is possible to browse apps in the Android application in a random fashion without problems. \\
			\hline
				ST07 & Passed & It is possible to install an app on an Arduino device through Bluetooth. \\
			\hline
				ST08 & Passed & It is possible to change the connected device without disconnecting first.\\
			\hline
		\end{longtable}


		\subsection{Usability testing}
		The results of the usability testing were positive overall. The scores varied from 57,5 to 90 out of a 100 with an average of 78,3. In the end, six people were tested with different technological backgrounds. Not many problems  occurred during the testing. One person did, however, have a small complaint about the consistency of the design of the application. After discussing it, it became apparent that this issue came from this person not being used to Android devices. 

		\subsection{Expert reviews}
		After the presentation by the customers request at the SINTEF offices, three people agreed to fill out SUS forms about their thoughts of the system. As there were still problems with the system, the scores reflected the criticism of expert uses, but received an average score of 54 out of a maximum of 100. The main ideas for improvements were stability and security. Stability was then worked on, but the security aspect was not recognized as an important focus point this late in the development. This was agreed upon by the customer after the meeting.

		\subsection{User acceptance testing}
		A formal user acceptance test session was not held, but during the last meeting with the customer, he got the opportunity to test the product. The customer was pleased with the performance of the system, and gave positive feedback.

		\subsection{Summary}
		Based on the tests performed during and after development of the product, Table~\ref{table:functionalsummary} describes to what degree the initial requirements set by the customer were met. As described in the Table~\ref{table:functionalsummary}, some of the requirements were omitted during the project as some tasks proved more time consuming than expected. As a result of this, not all the initial requirements have been met. \\
		\newline
		Regarding the non-functional requirements, it is difficult to summarize to what degree some of these requirements have been met. As a result of this not all the non-functional requirements is included in the table below.


		\captionof{table}{Functional requirements}
		\label{table:functionalsummary}
		\begin{longtable}{|m{0.15 \textwidth}|m{0.15 \textwidth}|m{0.6 \textwidth}|}
		\hline
			\rowcolor{Gray}
			\textbf{Requirement code} & \textbf{Result} & \textbf{Comment}\\
			\endfirsthead%
			\multicolumn{3}{l}%
			{{\bfseries Continued from previous page}} \\ \hline
			\rowcolor{Gray}
			\textbf{Requirement code} & \textbf{Result} & \textbf{Comment}\\
		\hline

			\endhead%
			\hline

			\hline \multicolumn{3}{|l|}{{Continued on next page}} \\ \hline
			\endfoot%

			\endlastfoot%
				FR01 & Passed & The Android application is communicating with the Arduino device, and it is possible to install all the apps featured in the Android application on the Arduino over the air.\\
			\hline
				FR02 & Passed & Usability testing was performed at SINTEF\newline workshop, and in the hallway at NTNU.\\
			\hline
				FR03 & Passed & Two example PUIs were made to prove the functionality of the product \\
			\hline
				FR04 & Passed & A valid Bluetooth connection stays active even if the Android application is minimized. When the application is killed and restarted, it will connect to the last connected Arduino device if in range\\
			\hline
				FR05 & Invalid & In agreement with the customer, this requirements was omitted \\
			\hline
				FR06 & Passed & The user of the Android application can connect with an Arduino using QR Code reader, input serial or choose from a list of available Arduino devices\\
			\hline
				NFR02 & Passed & The Android application is stable, and the Bluetooth connection is persistent even throughout the program \\
			\hline
				NFR03 & Passed & All code written is open source and under Apache 2.0 licence \\
			\hline
				NFR04 & Passed & The Android application is at least compatible with Android 2.3 and newer \\
			\hline
		\end{longtable}